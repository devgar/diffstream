<!DOCTYPE html>
<html>

<head>
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism.css" rel="stylesheet" />
  <script>
    window.Prism = window.Prism || {};
    Prism.manual = true;
  </script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/prism.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
  <title>Visual Studio Show!</title>
</head>

<body>
  <pre><code class="language-css">/* MAIN STYLE FILE */
p {
  color: red;
}

::placeholder {
  color: var(--placeholder);
  opacity: 1;
}</code>
  </pre>
  <script>
    const CODE = document.querySelector('code');
    const eventSource = new EventSource("/stream");
    let __documnet = {};
    eventSource.onmessage = function(e) {
      console.log('Unhandled Message:', e.data);
    };
    eventSource.onerror = function(e) {
      console.error(e);
    };
    eventSource.addEventListener('ping', (e) => console.log('ping', e.data) );

    eventSource.addEventListener('initial', (e) => {
      console.log('initial', e.data)
      window.LASTDATA = e.data
      __documnet = JSON.parse(e.data)
      const { language, content } = __documnet
      const r = Prism.highlight(content, Prism.languages[language], language)
      CODE.innerHTML = r
      CODE.className = `language-${language}`
    });
    
    eventSource.addEventListener('changeTextDocument', (e) => {
      console.log('changeTextDocument', e.data)
      window.LASTDATA = e.data
    });

    eventSource.addEventListener('changeActiveTextEditor', (e) => {
      console.log('changeActiveTextEditor', e.data)
      window.LASTDATA = e.data
    });

    eventSource.addEventListener('changeTextEditorVisibleRanges', (e) => {
      console.log('changeTextEditorVisibleRanges', e.data)
      window.LASTDATA = e.data
    });
  </script>
</body>

</html>